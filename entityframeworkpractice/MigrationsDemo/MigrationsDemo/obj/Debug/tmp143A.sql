DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MigrationsDemo.BlogContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201904120734164_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Blogs] (
        [BlogId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Blogs] PRIMARY KEY ([BlogId])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201904120734164_InitialCreate', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201904120752462_AddBlogUrl'
BEGIN
    ALTER TABLE [dbo].[Blogs] ADD [Url] [nvarchar](max)
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201904120752462_AddBlogUrl', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201904120821361_AddPostClass1'
BEGIN
    DECLARE @var0 nvarchar(128)
    SELECT @var0 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Blogs')
    AND col_name(parent_object_id, parent_column_id) = 'Rating';
    IF @var0 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Blogs] DROP CONSTRAINT [' + @var0 + ']')
    ALTER TABLE [dbo].[Blogs] DROP COLUMN [Rating]
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    CREATE UNIQUE INDEX [IX_Title] ON [dbo].[Posts]([Title])
    ALTER TABLE [dbo].[Blogs] ADD [Rating] [int] NOT NULL DEFAULT 3
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201904120821361_AddPostClass1', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D2F907F20F8D4028EE8CB4B6BAC1238921D08896CC36BE79DDA1DAD89F0B25D720DE9DBFAD04FEA2F74B877EDEA6637450B038245CE1C9E399C0BF5D71F7F061F574A9217C8AC307A4CCF46A794808E4C2C7432A6B95BBEFF957EFCF0EEA7E03A562BF2ADB6BBF076E8A9ED983E3B975E3266A36750DC8E94883263CDD28D22A3188F0D3B3F3DFD8D9D9D3140088A5884040FB9764241F105BF4E8C8E20753997731383B4D53AEE84052AB9E50A6CCA2318D3B94832EE90859D8232945C49C1914508724909D7DAB862F7F2C942E832A39330C5052E1FD729A0DD924B0B15F7CBD6FCD8304ECF7D18AC75ACA1A2DC3AA35E09787651E9C2FAEE6F529736BAA172D7A8B05BFBA80BF5C6F493340925FD832E2732F3467D6147DEFC846C2E9E34198089E2FF4EC824972ECF60AC2177199727E43E5F48117D81F5A3F90E7AAC7329BBBC9019EE6D2CE0D27D6652C8DCFA01961DB6B39812B6E9CBFACE8D6BCFAF8C69A6DDC53925B748822F2434D7DF893F742683CFA001E384F89E3B0719DEDE2C8642C00183DE79FEB33E0DF30DCB8692395F7D059DB8671495AF28B9112B88EB958AC193165865E8E4B21C0E1DF294C97FFD8C0794C303EF17AE8B11B036C786998735EDB840593B17E3D760E5B66421566B9588B6A2BB49B6C40CC175D02C252D81B2038CCA24DFC6B2E1D33617567697BA0BB11D6D2898F334456D3A6DA95A2161D99326EFC3D717AC2A315864B7D46DC3B63909D39427D0DBC5A391E98DC8AC9B72C717DCDFD1245603B3AEFA3B94AD4FEA0ADCAFD356EFDADAFF5F7A6CE91F7DFF56B91B0C466185157141C3A1EA5203B7621270C9B31DD53E3132577A5FE7D88752D67017A35C391EA128D02E40B170BC7F5D7C5D887A6D8812B09E8AFD6B62837BEA75D1FEA5EFAB97BE49737A5337BDFA08AA5C3D3CCB07C95B9A5082F2BC88D8276EB8B60ED4C81B8CC2DFE5440A8CB73598732D96605D396C288ED4F3DE93E0FF339E99B5B13C6246FF67D35278650FCEC3BD3361FF80D42F3C8B9E79F6B3E2AB5FBA48AF1C82FF086773D01531FFC03137ECC78707D9CE395696C398C60B7CE83E960CABC9F7C611372CCD80751FE3C114AC485A08FF34D710F99C6F416B9B995E9A5A5C8CA8CBA836E9693F07C76314E62A7362C92387DB11585BDCC7372E7334B9560B8867FA2E7769EEAEAC05B5901BAFB080ED3FBF98E39B9C83BBB4184C3F2204A4293004B8D39F7221E386F7CD96CCD901E173A4AA3064852F3A844BD60DD2ADD1470255F24D2105EDEBF311542A11CCDEE990BFC05BB8E143EC2B243C5AD71D7637C8E18BD8943D980A8E4F04652B8CD6DFFFC064FE17E687BF018F5C4A1A930E0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201904120836051_AddPostAbstract'
BEGIN
    ALTER TABLE [dbo].[Posts] ADD [Abstract] [nvarchar](max)
    UPDATE dbo.Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201904120836051_AddPostAbstract', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D2F907F20F8D4028EE8CB4B6BAC1238921D08896CC36BE79DDA1DAD89F0B25D720DE9DBFAD04FEA2F74B877EDEA6637450B038245CE1C9E399C0BF5D71F7F061F574A9217C8AC307A4CCF46A794808E4C2C7432A6B95BBEFF957EFCF0EEA7E03A562BF2ADB6BBF076E8A9ED983E3B975E3266A36750DC8E94883263CDD28D22A3188F0D3B3F3DFD8D9D9D3140088A5884040FB9764241F105BF4E8C8E20753997731383B4D53AEE84052AB9E50A6CCA2318D3B94832EE90859D8232945C49C1914508724909D7DAB862F7F2C942E832A39330C5052E1FD729A0DD924B0B15F7CBD6FCD8304ECF7D18AC75ACA1A2DC3AA35E09787651E9C2FAEE6F529736BAA172D7A8B05BFBA80BF5C6F493340925FD832E2732F3467D6147DEFC846C2E9E34198089E2FF4EC824972ECF60AC2177199727E43E5F48117D81F5A3F90E7AAC7329BBBC9019EE6D2CE0D27D6652C8DCFA01961DB6B39812B6E9CBFACE8D6BCFAF8C69A6DDC53925B748822F2434D7DF893F742683CFA001E384F89E3B0719DEDE2C8642C00183DE79FEB33E0DF30DCB8692395F7D059DB8671495AF28B9112B88EB958AC193165865E8E4B21C0E1DF294C97FFD8C0794C303EF17AE8B11B036C786998735EDB840593B17E3D760E5B66421566B9588B6A2BB49B6C40CC175D02C252D81B2038CCA24DFC6B2E1D33617567697BA0BB11D6D2898F334456D3A6DA95A2161D99326EFC3D717AC2A315864B7D46DC3B63909D39427D0DBC5A391E98DC8AC9B72C717DCDFD1245603B3AEFA3B94AD4FEA0ADCAFD356EFDADAFF5F7A6CE91F7DFF56B91B0C466185157141C3A1EA5203B7621270C9B31DD53E3132577A5FE7D88752D67017A35C391EA128D02E40B170BC7F5D7C5D887A6D8812B09E8AFD6B62837BEA75D1FEA5EFAB97BE49737A5337BDFA08AA5C3D3CCB07C95B9A5082F2BC88D8276EB8B60ED4C81B8CC2DFE5440A8CB73598732D96605D396C288ED4F3DE93E0FF339E99B5B13C6246FF67D35278650FCEC3BD3361FF80D42F3C8B9E79F6B3E2AB5FBA48AF1C82FF086773D01531FFC03137ECC78707D9CE395696C398C60B7CE83E960CABC9F7C611372CCD80751FE3C114AC485A08FF34D710F99C6F416B9B995E9A5A5C8CA8CBA836E9693F07C76314E62A7362C92387DB11585BDCC7372E7334B9560B8867FA2E7769EEAEAC05B5901BAFB080ED3FBF98E39B9C83BBB4184C3F2204A4293004B8D39F7221E386F7CD96CCD901E173A4AA3064852F3A844BD60DD2ADD1470255F24D2105EDEBF311542A11CCDEE990BFC05BB8E143EC2B243C5AD71D7637C8E18BD8943D980A8E4F04652B8CD6DFFFC064FE17E687BF018F5C4A1A930E0000 , N'6.2.0-61023')
END

